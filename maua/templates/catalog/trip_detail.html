{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2 class="section-heading-contrast">Trip #{{ trip.id }} - {{ trip.vehicle.plate_no }}</h2>
  <p class="section-text-contrast"><strong>Route:</strong> {{ trip.route.origin.town }} â†’ {{ trip.route.destination.town }}</p>
  <div class="mb-3">
    <span class="badge bg-success">Green = Checked-in/On board</span>
    <span class="badge bg-primary">Blue = Booked (not fetched)</span>
    <span class="badge bg-danger">Red = Available</span>
  </div>
  <div class="bus-layout-kenya-mini">
    {% set total = seat_layout|length %}
    {% set back_count = 4 if total >= 10 else (total % 3) %}
    {% set front_count = total - back_count %}
    {% set rows = seat_layout[:front_count] | batch(3, None) %}
    {% set back_row = seat_layout[front_count:] %}

    {% for row in rows %}
    <div class="bus-row">
      {% for s in row[:2] %}
        {% if s is not none %}
          {% set code = s['seat'] %}
          {% set status = seat_status.get(code, 'red') %}
          <span class="mini-seat {{ 'bg-success' if status=='green' else ('bg-primary' if status=='blue' else 'bg-danger') }}">{{ code }}</span>
        {% endif %}
      {% endfor %}
      <div class="aisle"></div>
      {% set s = (row[2] if (row|length) > 2 else None) %}
      {% if s is not none %}
        {% set code = s['seat'] %}
        {% set status = seat_status.get(code, 'red') %}
        <span class="mini-seat {{ 'bg-success' if status=='green' else ('bg-primary' if status=='blue' else 'bg-danger') }}">{{ code }}</span>
      {% endif %}
    </div>
    {% endfor %}

    {% if back_row %}
    <div class="bus-row back-row">
      {% for s in back_row %}
        {% set code = s['seat'] %}
        {% set status = seat_status.get(code, 'red') %}
        <span class="mini-seat {{ 'bg-success' if status=='green' else ('bg-primary' if status=='blue' else 'bg-danger') }}">{{ code }}</span>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  <div class="mt-3">
    <a class="btn btn-primary btn-lg btn-cta-contrast" href="{{ url_for('booking.book', trip_id=trip.id) }}">Book a Seat</a>
  </div>
</div>
{% endblock %}



{% extends 'staff/_layout.html' %}
{% block staff_content %}
  <h2>Trip Seats - #{{ trip.id }} ({{ trip.vehicle.plate_no }})</h2>
  <p><strong>Route:</strong> {{ trip.route.origin.town }} â†’ {{ trip.route.destination.town }} | <strong>Departs:</strong> {{ trip.depart_at.strftime('%Y-%m-%d %H:%M') }}</p>
  <div class="mb-2">
    <span class="badge bg-success">Green = Checked-in</span>
    <span class="badge bg-primary">Blue = Booked</span>
    <span class="badge bg-danger">Red = Available</span>
  </div>
  <div class="d-flex flex-wrap gap-2">
    {% for s in seat_layout %}
      {% set code = s['seat'] %}
      {% set b = seat_to_booking.get(code) %}
      {% set color = 'danger' %}
      {% if b %}
        {% if b.status in ['checked_in','completed'] %}
          {% set color = 'success' %}
        {% else %}
          {% set color = 'primary' %}
        {% endif %}
      {% endif %}
      <div class="badge bg-{{ color }}" style="min-width:64px">
        {{ code }}
        {% if b and b.status not in ['checked_in','completed'] %}
          <form method="post" action="{{ url_for('staff.trip_seat_checkin', trip_id=trip.id, seat=code) }}" style="display:inline">
            <button class="btn btn-sm btn-light" type="submit">Check in</button>
          </form>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  <div class="mt-3">
    <a class="btn btn-outline-secondary" href="{{ url_for('staff.trips_list') }}">Back</a>
  </div>
{% endblock %}


